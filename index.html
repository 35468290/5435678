<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Memorizer</title>
  <style>
    body {
      font-family: sans-serif;
      margin: 2rem;
      background: #f8f8f8;
    }
    textarea, input {
      width: 100%;
      padding: 0.5em;
      margin-bottom: 1em;
      font-size: 1rem;
    }
    button {
      padding: 0.5em 1em;
      font-size: 1rem;
      margin: 0.3em 0.3em 1em 0;
    }
    .sentence-block {
      border: 1px solid #ccc;
      background: #fff;
      padding: 1em;
      margin-bottom: 1em;
    }
    .word-checkbox {
      margin: 0.2em;
    }
    .hidden {
      display: none;
    }
    .correct {
      background-color: #c8ffc8;
    }
    .incorrect {
      background-color: #ffc8c8;
    }
    #dashboard {
      margin-bottom: 2rem;
      border-bottom: 1px solid #ccc;
      padding-bottom: 1rem;
    }
    .set-item {
      padding: 0.5em;
      background: #fff;
      border: 1px solid #ccc;
      margin-bottom: 0.5em;
    }
  </style>
</head>
<body>

  <h1>Chunk Text Memorizer</h1>

  <div id="dashboard">
    <h2>Saved Sets</h2>
    <div id="savedSets"></div>
  </div>

  <textarea id="textInput" rows="5" placeholder="Paste text with multiple sentences here..."></textarea>
  <input type="text" id="textTitle" placeholder="Title for this set" />
  <button onclick="processText()">Start New Set</button>
  <button onclick="saveCurrentSet()">Save This Set</button>

  <div id="practiceArea"></div>

  <script>
    const STORAGE_KEY = 'chunk_memorizer_sets';
    let data = [];
    let currentTitle = '';

    function getSavedSets() {
      return JSON.parse(localStorage.getItem(STORAGE_KEY) || '{}');
    }

    function saveAllSets(sets) {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(sets));
    }

    function updateDashboard() {
      const saved = getSavedSets();
      const list = document.getElementById('savedSets');
      list.innerHTML = '';

      for (const title in saved) {
        const div = document.createElement('div');
        div.className = 'set-item';

        const span = document.createElement('span');
        span.textContent = title;
        div.appendChild(span);

        const loadBtn = document.createElement('button');
        loadBtn.textContent = 'Practice';
        loadBtn.onclick = () => loadSet(title);
        div.appendChild(loadBtn);

        const delBtn = document.createElement('button');
        delBtn.textContent = 'Delete';
        delBtn.onclick = () => {
          if (confirm(`Delete "${title}"?`)) {
            deleteSet(title);
          }
        };
        div.appendChild(delBtn);

        list.appendChild(div);
      }
    }

    function deleteSet(title) {
      const saved = getSavedSets();
      delete saved[title];
      saveAllSets(saved);
      updateDashboard();
    }

    function processText() {
      const input = document.getElementById("textInput").value.trim();
      const title = document.getElementById("textTitle").value.trim();
      if (!input || !title) {
        alert('Please enter both a title and text.');
        return;
      }

      const lines = input.split(/\n+/).filter(Boolean);
      data = lines.map((line, index) => {
        const words = line.trim().split(/\s+/);
        return {
          id: Date.now() + index,
          fullText: line.trim(),
          words,
          selectedCount: 1,
          completed: false,
          reps: 0
        };
      });

      currentTitle = title;
      renderPracticeArea();
    }

    function renderPracticeArea() {
      const container = document.getElementById("practiceArea");
      container.innerHTML = '';

      data.forEach((item, idx) => {
        const block = document.createElement('div');
        block.className = 'sentence-block';
        block.id = 'block-' + item.id;

        const p = document.createElement('p');
        p.innerHTML = `<strong>Sentence ${idx + 1}:</strong> "${item.fullText}"`;
        block.appendChild(p);

        const checkboxContainer = document.createElement('div');
        item.words.forEach((word, i) => {
          const label = document.createElement('label');
          label.className = 'word-checkbox';
          const cb = document.createElement('input');
          cb.type = 'checkbox';
          cb.checked = i < item.selectedCount;
          cb.disabled = true;
          label.appendChild(cb);
          label.appendChild(document.createTextNode(' ' + word));
          checkboxContainer.appendChild(label);
        });
        block.appendChild(checkboxContainer);

        const input = document.createElement('input');
        input.type = 'text';
        input.placeholder = 'Type here...';
        input.onkeyup = (e) => {
          if (e.key === 'Enter') checkAnswer(item, input);
        };
        block.appendChild(input);

        const status = document.createElement('div');
        status.id = 'status-' + item.id;
        block.appendChild(status);

        const addBtn = document.createElement('button');
        addBtn.textContent = 'Add More Words';
        addBtn.onclick = () => {
          item.selectedCount = Math.min(item.words.length, item.selectedCount + 1);
          item.reps = 0;
          renderPracticeArea();
        };
        block.appendChild(addBtn);

        container.appendChild(block);
      });
    }

    function checkAnswer(item, inputEl) {
      const typed = inputEl.value.trim();
      const expected = item.words.slice(0, item.selectedCount).join(' ');
      const statusEl = document.getElementById('status-' + item.id);

      if (typed === expected) {
        item.reps++;
        inputEl.value = '';
        inputEl.classList.remove('incorrect');
        inputEl.classList.add('correct');
        statusEl.textContent = `‚úî Correct (${item.reps}/5)`;
        if (item.reps >= 5 && item.selectedCount < item.words.length) {
          statusEl.textContent += ' ‚Äì You can add more words now.';
        } else if (item.selectedCount === item.words.length && item.reps >= 5) {
          statusEl.textContent = `üéâ Sentence memorized!`;
          inputEl.disabled = true;
        }
      } else {
        inputEl.classList.remove('correct');
        inputEl.classList.add('incorrect');
        statusEl.textContent = '‚ùå Incorrect. Try again.';
      }
    }

    function saveCurrentSet() {
      if (!currentTitle || data.length === 0) {
        alert("Nothing to save.");
        return;
      }
      const sets = getSavedSets();
      sets[currentTitle] = data;
      saveAllSets(sets);
      alert("Set saved.");
      updateDashboard();
    }

    function loadSet(title) {
      const sets = getSavedSets();
      data = sets[title];
      currentTitle = title;
      renderPracticeArea();
    }

    updateDashboard();
  </script>
</body>
</html>
